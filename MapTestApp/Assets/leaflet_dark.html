<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Leaflet + CartoDB Dark</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #0a0a0a; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; height: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        const map = L.map('map', {
            center: [20, 0],
            zoom: 2,
            zoomControl: true,
            attributionControl: true
        });

        // CartoDB Dark Matter - free, no API key
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            subdomains: 'abcd',
            maxZoom: 20,
            minZoom: 1
        }).addTo(map);

        const markers = [];

        function getColor(confidence) {
            if (confidence >= 0.85) return '#00ff88';
            if (confidence >= 0.50) return '#ffdd00';
            return '#ff6666';
        }

        window.mapAPI = {
            addPin: function(lat, lon, label, confidence, rank, isExif) {
                const color = isExif ? '#00ffff' : getColor(confidence);

                const icon = L.divIcon({
                    className: 'custom-pin',
                    html: `<div style="
                        width: 24px;
                        height: 24px;
                        background: ${color};
                        border: 3px solid #000;
                        border-radius: 50% 50% 50% 0;
                        transform: rotate(-45deg);
                        box-shadow: 0 3px 10px rgba(0,0,0,0.6);
                    "></div>`,
                    iconSize: [24, 24],
                    iconAnchor: [12, 24]
                });

                const marker = L.marker([lat, lon], { icon: icon })
                    .bindPopup(`
                        <div style="color: #fff; background: #1a1a1a; padding: 8px;">
                            <h3 style="margin: 0 0 8px 0; font-size: 14px;">
                                ${isExif ? 'üìç EXIF GPS' : `#${rank} ${label}`}
                            </h3>
                            <p style="margin: 4px 0; font-size: 12px;">
                                ${(confidence * 100).toFixed(1)}% confidence
                            </p>
                        </div>
                    `)
                    .addTo(map);

                markers.push(marker);
            },
            flyTo: function(lat, lon, zoom, duration) {
                map.flyTo([lat, lon], zoom || 5, {
                    duration: (duration || 2000) / 1000
                });
            }
        };

        console.log('Leaflet + CartoDB Dark initialized');
    </script>
</body>
</html>

<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="GeoLens.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <!-- Page Transitions -->
    <Page.Transitions>
        <TransitionCollection>
            <NavigationThemeTransition>
                <NavigationThemeTransition.DefaultNavigationTransitionInfo>
                    <EntranceNavigationTransitionInfo/>
                </NavigationThemeTransition.DefaultNavigationTransitionInfo>
            </NavigationThemeTransition>
        </TransitionCollection>
    </Page.Transitions>

    <ScrollViewer>
        <StackPanel Spacing="8" Padding="56,24,56,56" MaxWidth="900">

            <!-- Page Header -->
            <TextBlock Text="Settings"
                      Style="{StaticResource TitleTextBlockStyle}"
                      Margin="0,0,0,24"/>

            <!-- Cache Settings -->
            <Expander Header="Cache Settings"
                     IsExpanded="True"
                     HorizontalAlignment="Stretch"
                     HorizontalContentAlignment="Stretch">
                <Expander.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE8B7;" FontSize="16"/>
                            <TextBlock Text="Cache Settings" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        </StackPanel>
                    </DataTemplate>
                </Expander.HeaderTemplate>

                <StackPanel Spacing="16" Margin="44,16,0,0">
                    <!-- Enable Cache -->
                    <ToggleSwitch x:Name="EnableCacheToggle"
                                 Header="Enable Prediction Cache"
                                 IsOn="True"
                                 OnContent="Enabled - Results cached for instant recall"
                                 OffContent="Disabled - All predictions will query API"
                                 Toggled="OnSettingChanged"/>

                    <!-- Cache Expiration -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Cache Expiration"
                                  Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        <ComboBox x:Name="CacheExpirationCombo"
                                 SelectedIndex="1"
                                 HorizontalAlignment="Stretch"
                                 MinWidth="200"
                                 SelectionChanged="OnSettingChanged">
                            <ComboBoxItem Content="7 days"/>
                            <ComboBoxItem Content="30 days"/>
                            <ComboBoxItem Content="90 days"/>
                            <ComboBoxItem Content="Never"/>
                        </ComboBox>
                    </StackPanel>

                    <!-- Cache Info -->
                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0" Spacing="4">
                            <TextBlock Text="Current Cache"
                                      Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                      FontSize="12"/>
                            <TextBlock x:Name="CacheInfoText"
                                      Text="0 entries, 0 MB"
                                      FontSize="13"
                                      FontWeight="SemiBold"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Spacing="8" Orientation="Horizontal">
                            <Button Content="View Statistics"
                                   Style="{StaticResource AccentButtonStyle}">
                                <Button.Flyout>
                                    <Flyout>
                                        <StackPanel Spacing="8" Width="250">
                                            <TextBlock Text="Cache Statistics" Style="{StaticResource SubtitleTextBlockStyle}"/>
                                            <TextBlock x:Name="StatTotalEntriesText" Text="Total Entries: 0" FontSize="12"/>
                                            <TextBlock x:Name="StatCacheHitsText" Text="Cache Hits: 0" FontSize="12"/>
                                            <TextBlock x:Name="StatCacheMissesText" Text="Cache Misses: 0" FontSize="12"/>
                                            <TextBlock x:Name="StatHitRateText" Text="Hit Rate: 0%" FontSize="12"/>
                                            <TextBlock x:Name="StatTotalSizeText" Text="Total Size: 0 MB" FontSize="12"/>
                                        </StackPanel>
                                    </Flyout>
                                </Button.Flyout>
                            </Button>
                            <Button x:Name="ClearCacheButton"
                                   Content="Clear Cache"
                                   Click="ClearCache_Click"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Expander>

            <!-- Prediction Settings -->
            <Expander Header="Prediction Settings"
                     IsExpanded="True"
                     HorizontalAlignment="Stretch"
                     HorizontalContentAlignment="Stretch">
                <Expander.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE774;" FontSize="16"/>
                            <TextBlock Text="Prediction Settings" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        </StackPanel>
                    </DataTemplate>
                </Expander.HeaderTemplate>

                <StackPanel Spacing="16" Margin="44,16,0,0">
                    <!-- EXIF GPS First -->
                    <ToggleSwitch x:Name="ExifGpsFirstToggle"
                                 Header="Show EXIF GPS First"
                                 IsOn="True"
                                 OnContent="EXIF GPS shown as primary result"
                                 OffContent="EXIF GPS shown with AI predictions"
                                 Toggled="OnSettingChanged"/>

                    <!-- Geographic Clustering -->
                    <ToggleSwitch x:Name="ClusteringToggle"
                                 Header="Enable Geographic Clustering"
                                 IsOn="True"
                                 OnContent="Boost confidence for clustered predictions"
                                 OffContent="Use raw probabilities only"
                                 Toggled="OnSettingChanged"/>
                </StackPanel>
            </Expander>

            <!-- Map Settings -->
            <Expander Header="Map Settings"
                     IsExpanded="False"
                     HorizontalAlignment="Stretch"
                     HorizontalContentAlignment="Stretch">
                <Expander.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE707;" FontSize="16"/>
                            <TextBlock Text="Map Settings" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        </StackPanel>
                    </DataTemplate>
                </Expander.HeaderTemplate>

                <StackPanel Spacing="16" Margin="44,16,0,0">
                    <!-- Offline Mode -->
                    <ToggleSwitch x:Name="OfflineModeToggle"
                                 Header="Offline Mode"
                                 IsOn="False"
                                 OnContent="Using local map tiles"
                                 OffContent="Using online map services"
                                 Toggled="OnSettingChanged"/>
                </StackPanel>
            </Expander>

            <!-- Interface Settings -->
            <Expander Header="Interface Settings"
                     IsExpanded="False"
                     HorizontalAlignment="Stretch"
                     HorizontalContentAlignment="Stretch">
                <Expander.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE771;" FontSize="16"/>
                            <TextBlock Text="Interface Settings" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        </StackPanel>
                    </DataTemplate>
                </Expander.HeaderTemplate>

                <StackPanel Spacing="16" Margin="44,16,0,0">
                    <!-- Show Thumbnails -->
                    <ToggleSwitch x:Name="ShowThumbnailsToggle"
                                 Header="Show Image Thumbnails"
                                 IsOn="True"
                                 OnContent="Thumbnails displayed in queue"
                                 OffContent="Text-only list mode"
                                 Toggled="OnSettingChanged"/>

                    <!-- Thumbnail Size -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Thumbnail Size"
                                  Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        <StackPanel Spacing="8">
                            <RadioButton x:Name="ThumbnailSizeSmallRadio"
                                        Content="Small (48px)"
                                        GroupName="ThumbnailSize"
                                        Checked="ThumbnailSize_Changed"/>
                            <RadioButton x:Name="ThumbnailSizeMediumRadio"
                                        Content="Medium (72px)"
                                        GroupName="ThumbnailSize"
                                        IsChecked="True"
                                        Checked="ThumbnailSize_Changed"/>
                            <RadioButton x:Name="ThumbnailSizeLargeRadio"
                                        Content="Large (96px)"
                                        GroupName="ThumbnailSize"
                                        Checked="ThumbnailSize_Changed"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Theme -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Application Theme"
                                  Style="{StaticResource BodyStrongTextBlockStyle}"/>
                        <StackPanel Spacing="8">
                            <RadioButton x:Name="ThemeDarkRadio"
                                        Content="Dark (Default)"
                                        GroupName="AppTheme"
                                        IsChecked="True"
                                        Checked="AppTheme_Changed"/>
                            <RadioButton x:Name="ThemeLightRadio"
                                        Content="Light"
                                        GroupName="AppTheme"
                                        Checked="AppTheme_Changed"/>
                            <RadioButton x:Name="ThemeSystemRadio"
                                        Content="Use System Setting"
                                        GroupName="AppTheme"
                                        Checked="AppTheme_Changed"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </Expander>

            <!-- Hardware Info -->
            <Expander Header="Hardware Information"
                     IsExpanded="True"
                     HorizontalAlignment="Stretch"
                     HorizontalContentAlignment="Stretch">
                <Expander.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE950;" FontSize="16"/>
                            <TextBlock Text="Hardware Information" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        </StackPanel>
                    </DataTemplate>
                </Expander.HeaderTemplate>

                <StackPanel Spacing="16" Margin="44,16,0,0">
                    <Grid RowSpacing="8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0"
                                  Text="Detected GPU:"
                                  Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock x:Name="DetectedGpuText"
                                  Grid.Row="0" Grid.Column="1"
                                  Text="Not detected yet"
                                  FontWeight="SemiBold"/>

                        <TextBlock Grid.Row="1" Grid.Column="0"
                                  Text="Using Runtime:"
                                  Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock x:Name="UsingRuntimeText"
                                  Grid.Row="1" Grid.Column="1"
                                  Text="CPU (python_cpu)"
                                  FontWeight="SemiBold"/>

                        <TextBlock Grid.Row="2" Grid.Column="0"
                                  Text="Model Status:"
                                  Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        <TextBlock x:Name="ModelStatusText"
                                  Grid.Row="2" Grid.Column="1"
                                  Text="Not loaded"
                                  FontWeight="SemiBold"/>
                    </Grid>

                    <StackPanel Spacing="8" Orientation="Horizontal">
                        <Button Content="Re-detect Hardware"
                               Style="{StaticResource AccentButtonStyle}"/>
                        <Button Content="View Model Info"/>
                    </StackPanel>
                </StackPanel>
            </Expander>

            <!-- About -->
            <Expander Header="About GeoLens"
                     IsExpanded="False"
                     HorizontalAlignment="Stretch"
                     HorizontalContentAlignment="Stretch">
                <Expander.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <FontIcon Glyph="&#xE946;" FontSize="16"/>
                            <TextBlock Text="About GeoLens" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        </StackPanel>
                    </DataTemplate>
                </Expander.HeaderTemplate>

                <StackPanel Spacing="12" Margin="44,16,0,0">
                    <TextBlock Text="GeoLens v2.4.0"
                              Style="{StaticResource SubtitleTextBlockStyle}"/>
                    <TextBlock TextWrapping="Wrap"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                        <Run Text="AI-powered image geolocation using the GeoCLIP deep learning model."/>
                        <LineBreak/>
                        <LineBreak/>
                        <Run Text="All inference runs locally with no cloud dependency."/>
                    </TextBlock>

                    <HyperlinkButton Content="View on GitHub" NavigateUri="https://github.com/LJAM96/geolens"/>

                    <TextBlock Text="Â© 2025 GeoLens Project"
                              Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                              FontSize="11"
                              Margin="0,8,0,0"/>
                </StackPanel>
            </Expander>
        </StackPanel>
    </ScrollViewer>
</Page>
